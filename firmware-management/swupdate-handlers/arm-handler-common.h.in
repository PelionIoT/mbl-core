/*
 * Copyright (c) 2019 Arm Limited and Contributors. All rights reserved.
 *
 * SPDX-License-Identifier: BSD-3-Clause
*/

static const char *const BOOTFLAGS_DIR = "@BOOTFLAGS_DIR@";
static const char *const UPDATE_PAYLOAD_DIR = "@UPDATE_PAYLOAD_DIR@";
static const char *const LOG_DIR = "@LOG_DIR@";
static const char *const ROOTFS_TYPE = "@ROOTFS_TYPE@";
static const char *const FACTORY_CONFIG_DIR= "@FACTORY_CONFIG_DIR@";

/* Create a new string buffer.
   This function allocates memory for a new string buffer. It is the caller's
   responsibility to free the allocated memory. */
void *malloc_or_abort(const size_t size);

/* Copy a string.
   This function allocates memory for the new string src is copied into.
   It is the caller's responsibility to free the allocated memory. */
char *str_copy_to_new(const char *const src);

/* Return 0 if fullstr ends with substr, else return non-zero */
int str_endswith(const char *const substr, const char *const fullstr);

/* Read a file to a new string.
   Allocate memory for a new string buffer the size of the file.
   Returns a pointer to the newly allocated string buffer.
   This function should not be used to read large files.
   It is the callers responsibility to free the memory allocated. */
char *read_file_to_new_str(const char *const filepath);

/* Get the device file path for the device at the given mount point and store
   it in dst */
int get_mounted_device(char *const dst, const char *const mount_point, const size_t dst_size);

/* Deduce the target bank by comparing the bank part numbers against the device file path
   store the target device file path in dst */
int find_target_partition(char *const dst
        , const char *const mounted_partition
        , const char *const bank1_part_num
        , const char *const bank2_part_num
        , const size_t dst_size);

/* Get the full path to a file from the part-info directory.
   This function gives no guarantee the path actually exists */
int get_part_info_filepath(char *const dst, const char *const file_name, const size_t dst_size);

/* Read the contents of a file from the part info directory to a new string.
   It is the callers responsibilty to free the memory allocated for the new string */
char *read_part_info_file_to_new_str(const char *const file_name);
