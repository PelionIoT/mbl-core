# Copyright (c) 2019, Arm Limited and Contributors. All rights reserved.
#
# SPDX-License-Identifier: BSD-3-Clause

metadata:
    format: "Lava-Test Test Definition 1.0"
    name: MBL Core Tests
    description: "MBL Core Tests behaviour"

params:
    # COMPONENT specifies the folder that pytest runs in. If this is not
    #           provided by the test submission pytest will run over the
    #           entire repository.
    #
    COMPONENT:

    # SETUP     performs whatever steps are necessary to set conditions prior
    #           to the test. If this isn't provided by the test submission no
    #           setup actions are performed.
    SETUP:

    # TEARDOWN  performs whatever steps are necessary to clean up after the
    #           test has executed. If this isn't provided by the test
    #           submission no teardown actions are performed.
    TEARDOWN:

run:
    steps:
        # Activate virtual environment
        - source /tmp/test_venv/bin/activate

        # Perform optional SETUP actions
        - $SETUP

        # Run pytest
        - pytest -v ./$COMPONENT | tee /tmp/test_venv/results.txt

        # Turn the pytest results into a format the LAVA requires
        - python3 ./ci/lava/dependencies/send_pytest_results_to_lava.py /tmp/test_venv/results.txt

        # Perform optional TEARDOWN actions
        - $TEARDOWN

        # Cleanup
        - /bin/rm //tmp/test_venv/results.txt
