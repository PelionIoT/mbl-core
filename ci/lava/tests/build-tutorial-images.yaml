# Copyright (c) 2019, Arm Limited and Contributors. All rights reserved.
#
# SPDX-License-Identifier: BSD-3-Clause

metadata:
    format: Lava-Test Test Definition 1.0
    name: Build Test Images
    description: Build Test Images

parameters:

    #
    # device: specifies the device of the UUT (armv7 or arm64)
    #
    device:

    #
    # virtual_env: specifies the Python virtual environment
    #
    virtual_env:

    #
    # host_tutorials_dir: specifies the output directory for the build artifacts
    #
    host_tutorials_dir:

    #
    # payload_version: specifies the payloaf version
    #
    payload_version:

run:
    steps:
        # Activate virtual environment
        - . $virtual_env/bin/activate

        # The tutorial is cloned as root, but we build it as user "ubuntu".
        # Give the directory write permisions so that the images can be written
        - chmod -R a+w tutorials

        # Build the Hello World sample app.
        - su ubuntu -c "$virtual_env/bin/pytest --verbose -s ./ci/lava/tests/test-build-tutorial-images.py --device $device --host-tutorials-dir $host_tutorials_dir --payload-version $payload_version"
